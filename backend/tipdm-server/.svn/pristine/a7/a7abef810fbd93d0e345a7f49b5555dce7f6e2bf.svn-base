package com.tipdm.framework.dmserver;

import com.tipdm.framework.controller.dmserver.entity.DataColumn;
import com.tipdm.framework.model.dmserver.DataType;
import com.tipdm.framework.model.dmserver.UserTable;
import com.tipdm.framework.repository.dmserver.UserTableRepository;
import com.tipdm.framework.service.dmserver.UserTableService;
import org.junit.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.annotation.Rollback;
import org.springframework.test.context.ContextConfiguration;
import org.springside.modules.test.spring.SpringTransactionalTestCase;

import javax.transaction.Transactional;
import java.io.File;
import java.util.ArrayList;
import java.util.List;

/**
 * Created by zhoulong on 2016/12/15.
 * E-mail:zhoulong8513@gmail.com
 */
@ContextConfiguration(locations = { "classpath*:/applicationContext*.xml" })
@Transactional
public class TableTest extends SpringTransactionalTestCase {

    @Autowired
    private UserTableService tableService;

    @Autowired
    private UserTableRepository tableRepository;

    @Test()
    @Rollback()
    public void testCreateTable(){

        UserTable table = new UserTable();
        table.setShowName("test");
        table.setTableName("t_admin_test");

        List<DataColumn> columns = new ArrayList<>();
        DataColumn column = new DataColumn();
        column.setName("name");
        column.setComment("test name");
        column.setDataType(DataType.text);
        columns.add(column);

        Long id = tableService.createTable(table, columns);

        System.out.println("return id:" + id);
    }

    @Test()
    @Rollback()
    public void testCopyData(){

        try {
            tableService.copyData(null, new File("d:/data_6.xlsx"), "tp_admin_test2", ",", "UTF-8");
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    @Test()
    @Rollback()
    public void testDropTable(){
        tableRepository.dropTable("test");
    }
}
