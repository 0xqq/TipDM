package com.tipdm.framework.dmserver;

import com.alibaba.fastjson.JSON;
import com.tipdm.framework.dmserver.mse.Model;
import com.tipdm.framework.dmserver.mse.ModelUtil;
import org.dmg.pmml.PMML;
import org.jpmml.evaluator.ModelEvaluator;
import org.jpmml.evaluator.ModelEvaluatorFactory;

import java.io.File;
import java.io.FileInputStream;

/**
 * Created by zhoulong on 2017/3/14.
 * E-mail:zhoulong8513@gmail.com
 */
public class PMMLTest {

    public static void main(String[] args){

//        File input = new File("D:\\workspace\\TipDM\\tipdm-dmserver\\target\\tipdm-dmserver\\model\\10000179_0_1.Rdata");
        File input = new File("d:/hhhh.pmml");
        File output = new File("d:/output.pmml");

        try {
//            PMMLUtils.convert(input, output, null);
            PMML pmml = org.jpmml.model.PMMLUtil.unmarshal(new FileInputStream(input));
            ModelEvaluatorFactory modelEvaluatorFactory = ModelEvaluatorFactory.newInstance();

            ModelEvaluator<?> modelEvaluator = modelEvaluatorFactory.newModelEvaluator(pmml);
            Model model = new Model(modelEvaluator);
            System.out.println(JSON.toJSONString(ModelUtil.toModelResponse("RandomForest", model, true), true));

//            DataType dataType = org.dmg.pmml.DataType.fromValue("date");
//            System.out.println(JSON.toJSON(dataType));
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
